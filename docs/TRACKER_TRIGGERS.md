# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¢—Ä–∏–≥–≥–µ—Ä–æ–≤ Yandex Tracker –¥–ª—è Test Agent

## üéØ –¶–µ–ª—å

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "–í —Ä–∞–±–æ—Ç–µ" (inProgress).

## üìã Workflow

```
open ‚Üí inProgress ‚Üí (Test Agent —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç) ‚Üí closed ‚úÖ
                                           ‚Üì (–µ—Å–ª–∏ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏)
                                          open ‚ùå
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –≤ Yandex Tracker

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—á–µ—Ä–µ–¥–∏

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –æ—á–µ—Ä–µ–¥—å **EXTEST** –≤ Yandex Tracker
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —à–µ—Å—Ç–µ—Ä–µ–Ω–∫—É ‚öôÔ∏è (–ù–∞—Å—Ç—Ä–æ–π–∫–∏)
3. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **"–¢—Ä–∏–≥–≥–µ—Ä—ã"**

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç—Ä–∏–≥–≥–µ—Ä

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"–°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä"**

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É—Å–ª–æ–≤–∏—è

**–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞**: `Test Agent - Auto Testing`

**–£—Å–ª–æ–≤–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è**:
- **–°–æ–±—ã—Ç–∏–µ**: –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—ë–Ω
- **–ó–Ω–∞—á–µ–Ω–∏–µ**: –í —Ä–∞–±–æ—Ç–µ (inProgress)

**–§–∏–ª—å—Ç—Ä—ã** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- –û—á–µ—Ä–µ–¥—å: EXTEST
- –¢–µ–≥–∏: –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥—É "automated-testing"

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è

**–î–µ–π—Å—Ç–≤–∏–µ**: HTTP –∑–∞–ø—Ä–æ—Å

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã HTTP –∑–∞–ø—Ä–æ—Å–∞**:

```
–ú–µ—Ç–æ–¥: POST
URL: http://YOUR_SERVER_IP:8080/webhook/tracker
Headers:
  Content-Type: application/json

–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:
{
  "issue": {
    "key": "{{issue.key}}",
    "summary": "{{issue.summary}}",
    "status": {
      "key": "{{issue.status.key}}",
      "display": "{{issue.status.display}}"
    }
  }
}
```

### –®–∞–≥ 5: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä

–ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å"**

## üåê –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ Webhook

### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å ngrok

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok
# https://ngrok.com/download

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç—É–Ω–Ω–µ–ª—å
ngrok http 8080

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π URL –≤ —Ç—Ä–∏–≥–≥–µ—Ä–µ
# –ù–∞–ø—Ä–∏–º–µ—Ä: https://abc123.ngrok.io/webhook/tracker
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä

1. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ webhook agent –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –ø—É–±–ª–∏—á–Ω—ã–º IP
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –ø–æ—Ä—Ç 8080
3. (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ reverse proxy (nginx) —Å HTTPS

```nginx
# –ü—Ä–∏–º–µ—Ä nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
server {
    listen 80;
    server_name your-domain.com;

    location /webhook/tracker {
        proxy_pass http://localhost:8080/webhook/tracker;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## üöÄ –ó–∞–ø—É—Å–∫ Webhook Test Agent

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
python scripts/run_webhook_test_agent.py

# –° –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
WEBHOOK_HOST=0.0.0.0 WEBHOOK_PORT=8080 python scripts/run_webhook_test_agent.py

# –í —Ñ–æ–Ω–µ (Linux/Mac)
nohup python scripts/run_webhook_test_agent.py > webhook_agent.log 2>&1 &

# –ß–µ—Ä–µ–∑ systemd (Linux)
sudo systemctl start webhook-test-agent
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ webhook —Å–µ—Ä–≤–µ—Ä–∞

```bash
curl http://localhost:8080/health
# –û—Ç–≤–µ—Ç: "Webhook Test Agent is running"
```

### 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ webhook –≤—Ä—É—á–Ω—É—é

```bash
curl -X POST http://localhost:8080/webhook/tracker \
  -H "Content-Type: application/json" \
  -d '{
    "issue": {
      "key": "EXTEST-11",
      "status": {"key": "inProgress"}
    }
  }'
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞

1. –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –ª—é–±—É—é –∑–∞–¥–∞—á—É –≤ —Å—Ç–∞—Ç—É—Å "–í —Ä–∞–±–æ—Ç–µ"
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ webhook agent
3. –î–æ–ª–∂–µ–Ω –Ω–∞—á–∞—Ç—å—Å—è –ø—Ä–æ—Ü–µ—Å—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ Test Agent

```bash
# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f webhook_agent.log

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
grep ERROR webhook_agent.log | tail -20
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –∑–∞–¥–∞—á–∞—Ö

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Test Agent –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:
- ‚úÖ "–¢–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã" - –∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç–∞
- ‚ùå "–¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏" - –∑–∞–¥–∞—á–∞ –≤–µ—Ä–Ω—ë—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å "–û—Ç–∫—Ä—ã—Ç–∞"

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –¥–ª—è webhook URL –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
2. **–î–æ–±–∞–≤—å—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é**:
   - –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
   - IP whitelist –¥–ª—è Yandex Tracker
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ rate limiting** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DDoS
4. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ webhook –∑–∞–ø—Ä–æ—Å—ã** –¥–ª—è –∞—É–¥–∏—Ç–∞

### –ü—Ä–∏–º–µ—Ä —Å —Ç–æ–∫–µ–Ω–æ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```python
# –í webhook_test_agent.py
WEBHOOK_SECRET = os.getenv("WEBHOOK_SECRET")

async def handle_webhook(self, request: web.Request):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
    auth_header = request.headers.get("X-Webhook-Secret")
    if auth_header != WEBHOOK_SECRET:
        return web.Response(text="Unauthorized", status=401)

    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

–í —Ç—Ä–∏–≥–≥–µ—Ä–µ Yandex Tracker:
```
Headers:
  Content-Type: application/json
  X-Webhook-Secret: YOUR_SECRET_TOKEN
```

## ‚ùì Troubleshooting

### –¢—Ä–∏–≥–≥–µ—Ä –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä –≤–∫–ª—é—á–µ–Ω (–∑–µ–ª—ë–Ω—ã–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL webhook –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –≤ Yandex Tracker

### Test Agent –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç webhook

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª –∏ –ø–æ—Ä—Ç—ã
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ webhook agent –∑–∞–ø—É—â–µ–Ω (`curl http://localhost:8080/health`)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ webhook agent

### –¢–µ—Å—Ç—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ mapping –∑–∞–¥–∞—á–∏ –≤ `TASK_TEST_MAPPING`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ pytest

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ –∑–∞–¥–∞—á–∏ –≤ —Å—Ç–∞—Ç—É—Å "–í —Ä–∞–±–æ—Ç–µ", Test Agent –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü–æ–ª—É—á–∏—Ç webhook –æ—Ç Yandex Tracker
2. –ó–∞–ø—É—Å—Ç–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã
3. –ó–∞–∫—Ä–æ–µ—Ç –∑–∞–¥–∞—á—É –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –∏–ª–∏ –≤–µ—Ä–Ω—ë—Ç –≤ —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ
