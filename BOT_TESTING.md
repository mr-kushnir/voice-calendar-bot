# Тестирование Voice Calendar Bot

## Статус бота

**Локально:**
- Status: ✅ RUNNING
- Username: @nlexamtestbot
- ID: 7409126315
- Mode: Polling

**В облаке:**
- VM: voice-bot-container (158.160.48.17)
- Status: RUNNING

## Быстрый тест

### 1. Проверка подключения

```bash
python test_bot.py
```

Ожидаемый результат:
```
[OK] Bot connected: @nlexamtestbot
[OK] Bot is operational!
```

### 2. Мониторинг в реальном времени

Запустите мониторинг перед тестированием:

```bash
python monitor_bot.py
```

Это покажет все сообщения, которые получает бот.

### 3. Ручное тестирование в Telegram

1. **Откройте Telegram**
2. **Найдите бота:** @nlexamtestbot
3. **Отправьте команду:** `/start`

Ожидаемый ответ:
```
Привет! Я помогу тебе управлять календарем голосом.

Команды:
/start - Начать работу
/help - Помощь
/stats - Статистика

Отправь мне голосовое сообщение или текстовую команду!
```

## Тестовые сценарии

### Сценарий 1: Текстовые команды

#### Тест 1.1: Запрос событий
**Команда:** "Что у меня сегодня в календаре?"

**Ожидаемое поведение:**
- Бот обрабатывает запрос через NLP (GPT-4)
- Запрашивает календарь (Yandex/Google)
- Возвращает список событий

#### Тест 1.2: Создание события
**Команда:** "Добавь встречу завтра в 15:00"

**Ожидаемое поведение:**
- Бот извлекает дату и время
- Создает событие в календаре
- Подтверждает создание

### Сценарий 2: Голосовые сообщения

#### Тест 2.1: Голосовой запрос
**Действие:** Отправить голосовое "Какие у меня встречи на завтра?"

**Ожидаемое поведение:**
- Бот распознает речь (Whisper STT)
- Обрабатывает через NLP
- Отвечает текстом или голосом (ElevenLabs TTS)

#### Тест 2.2: Голосовое создание события
**Действие:** Голосовое "Создай встречу на понедельник в 10 утра"

**Ожидаемое поведение:**
- STT распознает команду
- NLP извлекает параметры
- Создает событие
- Подтверждает голосом

### Сценарий 3: Интеграция с календарями

#### Тест 3.1: Yandex Calendar
**Команда:** "Покажи мой календарь Яндекс"

**Проверка:**
- Подключение к CalDAV
- Получение событий
- Корректное отображение

#### Тест 3.2: Google Calendar
**Команда:** "Покажи Google календарь"

**Проверка:**
- OAuth авторизация (если настроена)
- Получение событий
- Корректное отображение

## Проверка логов

### Локально (Docker)

```bash
# Все логи
docker-compose logs bot

# Последние 50 строк
docker-compose logs --tail=50 bot

# В реальном времени
docker-compose logs -f bot

# Или используйте monitor_bot.py
python monitor_bot.py
```

### На Yandex Cloud VM

```bash
# Serial port output
yc compute instance get-serial-port-output voice-bot-container

# Последние 100 строк
yc compute instance get-serial-port-output voice-bot-container | tail -100
```

## Диагностика проблем

### Бот не отвечает

1. **Проверьте, что бот запущен:**
   ```bash
   docker-compose ps
   # или
   yc compute instance list | grep voice-bot
   ```

2. **Проверьте логи на ошибки:**
   ```bash
   docker-compose logs bot | grep ERROR
   ```

3. **Проверьте токен Telegram:**
   ```bash
   python test_bot.py
   ```

### Ошибки при работе с календарем

1. **Проверьте переменные окружения:**
   ```bash
   grep YANDEX_CALENDAR .env
   ```

2. **Проверьте подключение к CalDAV:**
   - URL должен быть доступен
   - Логин/пароль корректны
   - Нет блокировки со стороны Яндекса

### STT/TTS не работает

1. **Проверьте API ключи:**
   ```bash
   grep -E "OPENAI|ELEVENLABS" .env
   ```

2. **Проверьте квоты API:**
   - OpenAI: https://platform.openai.com/usage
   - ElevenLabs: https://elevenlabs.io/usage

## Автоматическое тестирование

### Запуск всех тестов

```bash
# Unit тесты (если есть)
pytest tests/

# Интеграционные тесты
python test_bot.py
```

## Метрики производительности

### Ожидаемое время отклика

- **Текстовая команда:** < 2 сек
- **Голосовая команда (STT):** < 5 сек
- **Ответ с TTS:** < 7 сек
- **Запрос к календарю:** < 3 сек

### Использование ресурсов

**Docker (локально):**
- RAM: ~200-300 MB
- CPU: < 5% в idle, ~20-30% при обработке

**Yandex Cloud VM:**
- RAM: 2GB allocated
- CPU: 2 cores
- Disk: 30GB

## Известные ограничения

1. **Распознавание речи:** Работает лучше на русском языке
2. **TTS:** Требует ElevenLabs API key для озвучивания
3. **Календари:**
   - Yandex: Требует app password (не основной пароль)
   - Google: Требует OAuth настройку
4. **Режим работы:** Polling (не webhook), может быть задержка до 1-2 сек

## Рекомендации

1. **Перед деплоем:** Тестируйте локально
2. **Используйте мониторинг:** `monitor_bot.py` для отладки
3. **Проверяйте логи:** Регулярно проверяйте ошибки
4. **API квоты:** Следите за использованием OpenAI и ElevenLabs
5. **Backup:** Регулярно проверяйте, что события сохраняются в календаре

## Контакты для отчетов

При обнаружении проблем:
1. Сохраните логи (`docker-compose logs bot > logs.txt`)
2. Опишите шаги воспроизведения
3. Укажите ожидаемое и фактическое поведение
